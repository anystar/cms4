<!DOCTYPE html>
<html lang="en">
  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Web Works CMS</title>
  
	 <link href="{{ @BASE }}/admin/bootstrap.min.css" rel="stylesheet">
	 <link href="{{ @BASE }}/admin/theme" rel="stylesheet">

	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
	  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

	<style>
	.just-padding {

	}

	.list-group.list-group-root {
	   padding: 0;
	   overflow: hidden;
	}

	.list-group.list-group-root .list-group {
	   margin-bottom: 0;
	}

	.list-group.list-group-root .list-group-item {
	   border-radius: 0;
	   border-width: 1px 0 0 0;
	}

	.list-group.list-group-root > .list-group-item:first-child {
	   border-top-width: 0;
	}

	.list-group.list-group-root > .list-group > .list-group-item {
	   padding-left: 30px;
	}

	.list-group.list-group-root > .list-group > .list-group > .list-group-item {
	   padding-left: 45px;
	}

	.list-group-item .glyphicon {
	   margin-right: 5px;
	}

	</style>
  </head>
  <body>
	<h1><img src="{{@BASE}}/admin/imgs/logo.png" alt="Web Works CMS Login"></h1>

	<div class="nav top_nav">
	  <include href="/admin/navigation.html" with="{{@nav_active_content = active}}" />
	</div>
  
	<div class="container">


	  <div class="row">
		<div class="col-sm-3">
		  <div class="box">
			<h2>Site map</h2>
			
			<div class="list-group list-group-root well"></div>

		  </div>
		</div>
		<div class="col-sm-9">
		  <div class="box" style="padding-bottom: 0;">
			<h2>Contents</h2>
			<div>
				<button>Save</button> <button>Duplicate</button> <button>Delete</button>
			</div>

			<div id="editor" style="margin: 20px -10px 0 -10px;padding-top:30px"></div>
		  </div>
		</div>
	  </div>
	
	</div>

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="{{ @SETTINGS.cdn.ace }}" type="text/javascript" charset="utf-8"></script>

	<script src="{{@BASE}}/admin/bootstrap.min.js"></script>
	<script>
		var editor = ace.edit("editor");
		editor.getSession().setMode("ace/mode/html");
		editor.setTheme("ace/theme/chrome");
		editor.setOptions({
		    showGutter: true,
		    vScrollBarAlwaysVisible: false,
		    printMargin: false,
		    fontSize: 12,
		    minLines: 30,
		    maxLines: 1000
		});
		editor.container.style.lineHeight = 1.4;
		editor.renderer.updateFontSize()
		editor.commands.addCommand({
		    name: 'save',
		    bindKey: {win: "Ctrl-S", "mac": "Cmd-S"},
		    exec: function(editor) {
		        console.log("saving");
		    }
		})

		dir = JSON.parse('{{@content.site_map}}');

		$( document ).ready(function() {
			$(".file").click(function () {
				
				$.post("{{@BASE}}/admin/content/load-section", { file : $(this).html() }, openDocument);
				
				//$("#editor").load(, { file : $(this).html() });
			});
		});

		function openDocument (data) {
			
			//console.log(editor.getSession());

			editor.setValue(data, -1);

		}



		scan($(".list-group-root"), dir.root);

		function scan(element, directoryList) {

			if (directoryList.directories !== undefined) 
			{ 
				jQuery.each(directoryList.directories, function (i, v) {
					element.append($('<a href="#'+i+'" class="list-group-item" data-toggle="collapse"><i class="glyphicon glyphicon-chevron-right"></i>'+i+' </a>'));
					element.append(scan($('<div class="list-group collapse" id="'+i+'"></div>'), v)); 
				});
			}

			if (directoryList.files != undefined)
			{
				jQuery.each(directoryList.files, function (i, v) {
					element.append($('<a class="list-group-item file">'+v+'</a>'));
				});
			}

			return element;
		}

	</script>
	
  </body>
</html>