<!DOCTYPE html>
<html lang="en">
  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	<title>Web Works CMS</title>

	<!-- Bootstrap -->
	<link href="{{ @BASE }}/admin/bootstrap.min.css" rel="stylesheet">
	<link href="{{ @BASE }}/admin/theme" rel="stylesheet">

	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
	  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

	<style>
		.bootstrap-select {
			width: 100px;
		}
	</style>
  </head>
  <body>
	<h1><img src="{{@BASE}}/admin/imgs/logo.png" alt="Web Works CMS Login"></h1>

	<div class="nav top_nav">
		<include href="/admin/navigation.html" with="{{nav_active_contact_form=active}}"  />
	</div>
	
	<div class="container">
		
		<include href="admin/toolbar.html">

		<div class="row">
			<div class="col-xs-12 col-md-5">
				<div class="box">
					<h2>Settings</h2>

					<form action="{{@BASE}}/admin/{{@namespace}}/settings" method="post">
						<div class="form-group">
							<label>Email</label>
							<input name="email" type="text" class="form-control" value="{{@contact.email}}">
							<span class="help-block">What address do we send too? (eg: business owner's email)</span>  
						</div>

						<div class="form-group">
							<label>Name</label>
							<input name="name" type="text" class="form-control" value="{{@contact.name}}">
							<span class="help-block">Who should the email address? (eg: business owner's name)</span> 
						</div>

						<div class="form-group">
							<label>Subject Line</label>
							<input name="subject" type="text" class="form-control" value="{{@contact.subject}}">
							<span class="help-block">eg: &lt;business name&gt; website enquiry</span>
						</div>


						<div style="text-align:right;">
							<button>Apply settings <span class="glyphicon glyphicon-saved"></span></button>
						</div>
					</form>
				</div>
			</div>
			<div class="col-xs-12 col-md-7">
				<div class="box">
					<h2>Test center</h2>
					
					<check if="{{@contact.form_successfully_submitted}}">
						EMAIL SUCESSFULLY SUBMITTED
					</check>

					<form class="form-horizontal" action="{{@contact.action}}" method="post">
						<repeat group="{{@contact.form}}" value="{{@field}}">
							<switch expr="{{@field.type}}">
								<case value="name">
									<set value="John Smith">
								</case>
								<case value="number">
									<set value="(03) 54444444">
								</case>
								<case value="email">
									<set value="johnsmith@example.com">
								</case>
								<case value="textarea">
									<set value="This is a test email from the admin panel">
								</case>
								<case value="text">
									<set value="Dummy text">
								</case>
								<default>
									<set value="">
								</default>
							</switch>
							
							<div class="form-group">
								<label for="{{@field.label}}" class="col-sm-3 control-label">{{@field.label}}</label>
								<div class="col-sm-9">
									<input name="{{@field.name}}" value="{{@value}}" type="input" class="form-control" id="{{@field.label}}" placeholder="{{@field.placeholder}}">
								</div>
							</div>

						</repeat>
						
					    <check if="{{@contact.captcha_error==1}}">
					      <true>
					      <div class="input-group pull-right has-error" style="margin-bottom:15px;width:85%">
					        <div class="input-group-addon"><img src="{{@BASE}}/{{@namespace}}/captcha" alt="captcha" /></div>
					        <input name="captcha" style="height: 50px" type="text" class="form-control" id="exampleInputAmount" placeholder="Are you human?">
					        <span class="glyphicon glyphicon-remove form-control-feedback"></span>
					      </div>
					      </true>

					      <false>
					      <div class="input-group pull-right" style="margin-bottom:15px;width:85%">
					        <div class="input-group-addon"><img src="{{@BASE}}/{{@namespace}}/captcha" alt="captcha" /></div>
					        <input name="captcha" style="height: 50px" type="text" class="form-control" id="exampleInputAmount" placeholder="Are you human?">
					      </div>
					      </false>
					    </check>

						<div class="clearfix"></div>
						
						<hr>
						<div class="form-group">
							<label for="sendto" class="col-sm-3 control-label">Send test to:</label>
							<div class="col-sm-9">
								<input name="sendto" value="{{@contact.email}}" type="email" class="form-control" placeholder="">
							</div>
						</div>

						<div style="text-align: center;padding:10px 0;">After hitting submit please check your email. It may take up to 10 minutes to receive.</div>

						<div style="text-align:right">
							<button type="submit">Submit Test Email</button>
						</div>

						<input type="hidden" name="actionid" value="{{@contact.actionid}}">
					</form>
				</div>
			</div>
		</div>

		<div class="col-md-12">
			<div class="row">
				<div class="box">
					<h2>Contact Form</h2>
					
					<table class="table table-condensed table-responsive">
						<thead>
							<th>Label</th>
							<th>Type</th>
							<th>Placeholder</th>
							<th>Error Message</th>
							<th>Order</th>
							<th></th>
						</thead>

						<repeat group="{{@contact.form}}" value="{{@field}}">
							<tr class="field" title="{{@field.id}}">
								<form title="{{@field.id}}" class="update_field" action="{{@BASE}}/admin/{{@namespace}}/update_field" method="post">
								<td width="130" class="orderbuttons">
									<button type="button" class="up"><span class="glyphicon glyphicon-arrow-up"></span></button>
									<button type="button" class="down"><span class="glyphicon glyphicon-arrow-down"></span></button>
								</td>
								<td>
									<div class="input-group">
									  <input name="label" type="text" class="form-control" placeholder="input label" value="{{@field.label}}">
									</div>
								</td>
								<td>
								   <div class="input-group">

									  <select name="type">
										<option <check if="{{@field.type=='name'}}">selected</check> value="name">Name</option>
										<option <check if="{{@field.type=='text'}}">selected</check> value="text">Text</option>
										<option <check if="{{@field.type=='textarea'}}">selected</check> value="textarea">Textarea</option>
										<option <check if="{{@field.type=='number'}}">selected</check> value="number">Number</option>
										<option <check if="{{@field.type=='email'}}">selected</check> value="email">Email</option>
									  </select>
								   </div>
								</td>
								<td>
									<div class="input-group">
									  <input name="placeholder" type="text" class="form-control" placeholder="text you're reading now" value="{{@field.placeholder}}">
									</div>
								</td>
								<td>
									<div class="input-group">
									  <input name="error_message" type="text" class="form-control" value="{{@field.error_message}}">
									</div>
								</td>
								<td><a href="{{@BASE}}/admin/{{@namespace}}/delete_field/{{@field.id}}"><button type="button">Delete</button></a></td>
								<td><button class="update_field" type="submit">Update</button></td>
								</form>
							</tr>
						</repeat>
						
						<check if="{{@webmaster}}">
						<tr>
							<form action="{{@BASE}}/admin/{{@namespace}}/add_field" method="post">
							<td width="130"></td>
							<td>
								<div class="input-group">
								  <input name="label" type="text" class="form-control" placeholder="input label">
								</div>
							</td>
							<td>
							   <div class="input-group">
								  <select name="type" class="">
									<option value="name">Name</option>
									<option value="text">Text</option>
									<option value="textarea">Textarea</option>
									<option value="number">Number</option>
									<option value="email">Email</option>
								  </select>
							   </div>
							</td>
							<td>
								<div class="input-group">
								  <input name="placeholder" type="text" class="form-control" placeholder="text you're reading now">
								</div>
							</td>
							<td>
								<div class="input-group">
								  <input name="error_message" type="text" class="form-control">
								</div>
							</td>
							<td><a href="{{@BASE}}/"><button type="submit">Add</button></a></td>
						</form>
						</tr>
						</check>
					</table>
				</div>
			</div>

		</div>

		<div class="row">
			<div class="col-md-12">
				<div class="box">
					<h2>Email Template</h2>
					
						<script>
							function resizeIframe(obj) {
								obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
							}
						</script>
						<iframe frameborder="0" scrolling="no" width="100%" onload="resizeIframe(this)" src="{{@BASE}}/admin/{{@namespace}}/email_template"></iframe>

				</div>
			</div>
		</div>
	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="{{@BASE}}/admin/bootstrap.min.js"></script>

	<script>

		$(".update_field").submit(function () {

			$.post("{{@BASE}}/admin/{{@namespace}}/update_field/"+$(this).attr("title"), {
				data: $(this).serialize()
			});

			return false;

		});

		$(".up,.down").click(function() {
			var row = $(this).parents("tr:first");

			if ($(this).is(".up")) {
				row.insertBefore(row.prev());
			} else {
				row.insertAfter(row.next());
			}

			var order = [];
			$(".field").each(function () {
				order.push($(this).attr("title"));
			});

			$.ajax({
				method: "POST",
				url: "{{@BASE}}/admin/{{@namespace}}/update_order",
				data: { "fields_order": JSON.stringify(order) }
			});
		});
	</script>

	{{@debug}}
  </body>
</html>