<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
		<title>Web Works CMS</title>

		<!-- Bootstrap -->
		<link href="{{ @BASE }}/admin/bootstrap.min.css" rel="stylesheet">
		<link href="{{ @BASE }}/admin/theme" rel="stylesheet">
		<link href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/4.3.0/min/dropzone.min.css" rel="stylesheet">
		<link href="{{ @BASE }}/banners/slider.css" rel="stylesheet">

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
		
		<style>
			.images-table {
				margin-top: 20px;
			}
			
			.banner_images td {
				width: 400px;
				vertical-align: middle !important;
			}

			.banner_images img {
				max-width: 400px;
			}

			.dropzone {
				margin: 30px;
				border: 2px dashed #777;
			}

			.dropzone .dz-message {
				font-weight: bold;
				font-size: 20px;
			}

			.admin_banner_display {
				margin: 0 auto;
			}

			.admin_banner_display #message {
				font-size: 20px;
				font-weight: bold;
				text-align: center;
				height: 100%;
				width: 100%;
				border: 2px dotted #777;
				background-color: #ccc;
				-webkit-border-radius: 8px;
				-moz-border-radius: 8px;
				border-radius: 8px;
			}

			.orderbuttons {
				width: 10%;
			}

			.image_upload_settings {
			  margin-top: 20px; 
			  width: 100%;
			}
			.image_upload_settings .form-group {
			  display: block;
			  margin-top: 5px; }
			.image_upload_settings .form-control {
			  width: 80px; }
			.image_upload_settings label {
			  width: 150px; }
			.image_upload_settings button {
			  width: 100%;
			  margin: 20px 0;
			  font-weight: bold; }


		</style>
	</head>
	<body>
		<h1><img src="{{@BASE}}/admin/imgs/logo.png" alt="Web Works CMS Login"></h1>

		<div class="nav top_nav">
			<include href="/admin/navigation.html" with="{{nav_active_banners=active}}"  />
		</div>
		
		<div class="container">
			<check if="{{@webmaster}}">
				<div class="row box module-bar">
					<div class="col-xs-8">
						<header>Banners</header>
					</div>

					<div class="col-xs-4" style="text-align:right;">
						<button>Uninstall</button>
						<a href="{{@BASE}}/admin/{{@namespace}}/documentation"><button>Documentation</button></a>
					</div>
				</div>
			</check>

			<div class="box">
				<h2>Banner example</h2> 
			
				<div class="admin_banner_display">
					{{@banners.html}}
				</div>
			</div>
		

			<div class="row">
				<check if="{{@webmaster}}">
					<true><set colwidth="col-xs-12 col-md-8"></true>
					<false><set colwidth="col-md-12"></false>
				</check>

				<div class="{{@colwidth}}">	
					<div class="box">
						<h2>Banner images</h2>

						<table class="images-table table table-bordered">
							<thead>
								<th width="10%">Order</th>
								<th>Image</th>
								<th width="10%">Tools</th>
							</thead>
							
							<tbody>					
								<repeat group="{{@banners.images}}" value="{{@image}}">
								<tr class="banner_images">
									<td class="orderbuttons">
										<button class="up"><span class="glyphicon glyphicon-arrow-up"></span></button>
										<button class="down"><span class="glyphicon glyphicon-arrow-down"></span></button>
									</td>
									<td width="100%"><a target="_blank" href="{{@BASE}}/{{@image.url}}"><img title="{{@image.filename}}" class="bannerimage" width="100%" src="{{@BASE}}/{{@image.url}}" /></a></td>
									<td class="tools">
										<a class="delete_image" href="{{@BASE}}/admin/{{@namespace}}/delete/{{@image.filename}}"><button>Delete</button></a>
									</td>
								</tr>
								</repeat>
							</tbody>
						</table>

						<form method="post" action="{{@BASE}}/admin/{{@namespace}}/dropzone" class="dropzone" id="gallerydropzone">
						  <div class="dz-message">
							<div>Click or Drop banner images here.</div>
			 				<div>Max file size: {{@max_upload_size}}</div>
						  </div>
						</form>

					</div>
				</div>
				<check if="{{@webmaster}}">
				<div class="col-md-4">
				
					<div class="box">
						<h2>Upload settings</h2>
						<div class="container image_upload_settings">
						
							<form  action="{{@BASE}}/admin/{{@namespace}}/update_settings" method="POST" class="form-inline">
								<div class="form-group">
								  <label for="b">Image size: </label>
								  <input name="width" value="{{@SETTINGS.banners_width}}" type="text" class="form-control" id="b" placeholder="Width"> <span class="glyphicon glyphicon-remove"></span> <input name="height" value="{{@SETTINGS.banners_height}}" type="text" class="form-control" id="exampleInputName2" placeholder="Height">
								</div>
								<button type="submit">Apply settings to take effect</button>

								<p>These settings will</p>
								<ul>
									<li>resize images when uploaded</li>
									<li>ignores aspect ratio. <br>(shrinks and then crops from center)</li>
									<li>images will enlarge.</li>
								</ul>
								<ul>
									<li>Leave blank to not resize.</li>
								</ul>
							</form>
						</div>
					</div>
				</div>
				</check>
			</div>
		</div>
		

		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src="{{ @BASE }}/admin/bootstrap.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/4.3.0/min/dropzone.min.js"></script>
		<script src="{{ @BASE }}/banners/slider.js"></script>

	<script>
		$(function() {
			$(".delete_image").click(function (d) {
				
				$.ajax(d.currentTarget.href);
				
				var msg = $("<div id='message'>Please refresh page to update banner system</div>");
				msg.css("height", $(".admin_banner_display").height());

				$(".admin_banner_display").html(msg);
				$(this).parent().parent().remove();

				return false;
			});


			$(".up,.down").click(function(){
				var row = $(this).parents("tr:first");

				if ($(this).is(".up")) {
					row.insertBefore(row.prev());
				} else {
					row.insertAfter(row.next());
				}


				var order = [];
				$(".bannerimage").each(function () {
					order.push($(this).attr("title"));
				});
				
				var msg = $("<div id='message'>Please refresh page to update banner system</div>");
				msg.css("height", $(".admin_banner_display").height());

				$(".admin_banner_display").html(msg);

				$.ajax({
					method: "POST",
					url: "{{@BASE}}/admin/{{@namespace}}/update_settings",
					data: { "banners_order": JSON.stringify(order) }
				});
			});
		});

	  Dropzone.autoDiscover = false;
	  Dropzone.options.gallerydropzone = {
			init: function() {
				this.on("queuecomplete", function(file) { 
					location.reload();  
				});
			}
	  };

	  new Dropzone("#gallerydropzone");
	</script>

	</body>
</html>